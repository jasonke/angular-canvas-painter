"use strict";!function(e){angular.module("pw.canvas-painter",[]),function(e){try{e=angular.module("pw.canvas-painter")}catch(t){e=angular.module("pw.canvas-painter",[])}e.run(["$templateCache",function(e){e.put("../templates/canvas.html",'<div class="pwCanvasPaint" style="position:relative"><canvas id="pwCanvasMain"></canvas><canvas id="pwCanvasTmp" style="position:absolute;top:0;left:0"></canvas></div>')}])}(),function(e){try{e=angular.module("pw.canvas-painter")}catch(t){e=angular.module("pw.canvas-painter",[])}e.run(["$templateCache",function(e){e.put("../templates/color-selector.html",'<ul class="pwColorSelector"><li ng-repeat="color in colorList track by $index" class="pwColor" ng-class="{\'active\': selectedIndex === $index}" style="background-color: {{color}}" ng-click="select($index, color)"></li></ul>')}])}(),angular.module("pw.canvas-painter").directive("pwCanvas",function(){return{restrict:"AE",scope:{options:"="},templateUrl:"../templates/canvas.html",link:function(t){var n=!0,o=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1,a=n?"touchstart":"mousedown",i=n?"touchmove":"mousemove",l=n?"touchend":"mouseup",c=t.options;c.width=c.width||400,c.height=c.height||300,c.backgroundColor=c.backgroundColor||"#fff",c.color=c.color||"#000",c.undoEnabled=c.undoEnabled||!1,c.opacity=c.opacity||.9,c.lineWidth=c.lineWidth||1;var r=document.getElementById("pwCanvasMain"),s=document.getElementById("pwCanvasTmp"),u=r.getContext("2d"),d=s.getContext("2d"),h={x:0,y:0},p=[];r.width=s.width=c.width,r.height=s.height=c.height,u.fillStyle=c.backgroundColor,u.fillRect(0,0,r.width,r.height),d.globalAlpha=c.opacity,d.lineJoin=d.lineCap="round",d.lineWidth=10,d.strokeStyle=c.color,t.$watch("options.lineWidth",function(e){e&&"number"==typeof e&&(d.lineWidth=c.lineWidth=e)}),t.$watch("options.color",function(e){e&&(d.strokeStyle=d.fillStyle=e)}),t.$watch("options.opacity",function(e){e&&(d.globalAlpha=e)});var v=function(e,t){n?o?(e.x=t.layerX,e.y=t.layerY):(e.x=t.changedTouches[0].clientX-t.target.offsetParent.offsetLeft,e.y=t.changedTouches[0].clientY-t.target.offsetParent.offsetTop):(e.x=void 0!==t.offsetX?t.offsetX:t.layerX,e.y=void 0!==t.offsetY?t.offsetY:t.layerY)},f=function(e){if(e&&(e.preventDefault(),v(h,e)),p.push({x:h.x,y:h.y}),3==p.length){var t=p[0];return d.beginPath(),d.arc(t.x,t.y,d.lineWidth/2,0,2*Math.PI,!0),d.fill(),d.closePath(),void 0}d.clearRect(0,0,s.width,s.height),d.beginPath(),d.moveTo(p[0].x,p[0].y);for(var n=1;n<p.length-2;n++){var o=(p[n].x+p[n+1].x)/2,a=(p[n].y+p[n+1].y)/2;d.quadraticCurveTo(p[n].x,p[n].y,o,a)}d.quadraticCurveTo(p[n].x,p[n].y,p[n+1].x,p[n+1].y),d.stroke()},g=function(){n||e.addEventListener(l,function(){s.removeEventListener(i,f,!1),u.drawImage(s,0,0),d.clearRect(0,0,s.width,s.height),p=[]},!1),s.addEventListener(a,function(e){e.preventDefault(),s.addEventListener(i,f,!1),v(h,e),p.push({x:h.x,y:h.y}),p.push({x:h.x,y:h.y}),f()},!1),s.addEventListener(l,function(){s.removeEventListener(i,f,!1),u.drawImage(s,0,0),d.clearRect(0,0,s.width,s.height),p=[]},!1)};g()}}}),angular.module("pw.canvas-painter").directive("pwColorSelector",function(){return{restrict:"AE",replace:!0,scope:{colorList:"=pwColorSelector",color:"="},templateUrl:"../templates/color-selector.html",link:function(e){e.select=function(t,n){e.selectedIndex=t,e.color=n}}}})}(this);