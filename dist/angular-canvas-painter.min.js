"use strict";!function(t){angular.module("pw.canvas-painter",[]),function(t){try{t=angular.module("pw.canvas-painter")}catch(e){t=angular.module("pw.canvas-painter",[])}t.run(["$templateCache",function(t){t.put("../templates/canvas.html",'<div class="pwCanvasPaint" style="position:relative"><canvas id="pwCanvasMain"></canvas><canvas id="pwCanvasTmp" style="position:absolute;top:0;left:0"></canvas></div>')}])}(),function(t){try{t=angular.module("pw.canvas-painter")}catch(e){t=angular.module("pw.canvas-painter",[])}t.run(["$templateCache",function(t){t.put("../templates/color-selector.html",'<ul class="pwColorSelector"><li ng-repeat="color in colorList track by $index" class="pwColor" ng-class="{\'active\': selectedIndex === $index}" style="background-color: {{color}}" ng-click="select($index, color)"></li></ul>')}])}(),angular.module("pw.canvas-painter").directive("pwCanvas",function(){return{restrict:"AE",scope:{options:"="},templateUrl:"../templates/canvas.html",link:function(e){var n=!!("ontouchstart"in t),o=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1,a=n?"touchstart":"mousedown",i=n?"touchmove":"mousemove",l=n?"touchend":"mouseup",c=e.options;c.width=c.width||400,c.height=c.height||300,c.backgroundColor=c.backgroundColor||"#fff",c.color=c.color||"#000",c.undoEnabled=c.undoEnabled||!1,c.opacity=c.opacity||.9,c.lineWidth=c.lineWidth||1;var r=document.getElementById("pwCanvasMain"),s=document.getElementById("pwCanvasTmp"),u=r.getContext("2d"),d=s.getContext("2d"),h={x:0,y:0},p=[];r.width=s.width=c.width,r.height=s.height=c.height,u.fillStyle=c.backgroundColor,u.fillRect(0,0,r.width,r.height),d.globalAlpha=c.opacity,d.lineJoin=d.lineCap="round",d.lineWidth=10,d.strokeStyle=c.color,e.$watch("options.lineWidth",function(t){t&&"number"==typeof t&&(d.lineWidth=c.lineWidth=t)}),e.$watch("options.color",function(t){t&&(d.strokeStyle=d.fillStyle=t)}),e.$watch("options.opacity",function(t){t&&(d.globalAlpha=t)});var v=function(t,e){n?o?(t.x=e.layerX,t.y=e.layerY):(t.x=e.changedTouches[0].clientX-e.target.offsetParent.offsetLeft,t.y=e.changedTouches[0].clientY-e.target.offsetParent.offsetTop):(t.x=void 0!==e.offsetX?e.offsetX:e.layerX,t.y=void 0!==e.offsetY?e.offsetY:e.layerY)},f=function(t){if(t&&(t.preventDefault(),v(h,t)),p.push({x:h.x,y:h.y}),3==p.length){var e=p[0];return d.beginPath(),d.arc(e.x,e.y,d.lineWidth/2,0,2*Math.PI,!0),d.fill(),d.closePath(),void 0}d.clearRect(0,0,s.width,s.height),d.beginPath(),d.moveTo(p[0].x,p[0].y);for(var n=1;n<p.length-2;n++){var o=(p[n].x+p[n+1].x)/2,a=(p[n].y+p[n+1].y)/2;d.quadraticCurveTo(p[n].x,p[n].y,o,a)}d.quadraticCurveTo(p[n].x,p[n].y,p[n+1].x,p[n+1].y),d.stroke()},g=function(){n||t.addEventListener(l,function(){s.removeEventListener(i,f,!1),u.drawImage(s,0,0),d.clearRect(0,0,s.width,s.height),p=[]},!1),s.addEventListener(a,function(t){t.preventDefault(),s.addEventListener(i,f,!1),v(h,t),p.push({x:h.x,y:h.y}),p.push({x:h.x,y:h.y}),f()},!1),s.addEventListener(l,function(){s.removeEventListener(i,f,!1),u.drawImage(s,0,0),d.clearRect(0,0,s.width,s.height),p=[]},!1)};g()}}}),angular.module("pw.canvas-painter").directive("pwColorSelector",function(){return{restrict:"AE",replace:!0,scope:{colorList:"=pwColorSelector",color:"="},templateUrl:"../templates/color-selector.html",link:function(t){t.select=function(e,n){t.selectedIndex=e,t.color=n}}}})}(this);