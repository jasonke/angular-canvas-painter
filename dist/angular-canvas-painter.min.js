!function(e){!function(e){try{e=angular.module("pw.canvas-painter")}catch(t){e=angular.module("pw.canvas-painter",[])}e.run(["$templateCache",function(e){e.put("canvas.html",'<div class="pwCanvasPaint" style="position:relative"><canvas id="pwCanvasMain"></canvas><canvas id="pwCanvasTmp" style="position:absolute;top:0;left:0"></canvas></div>')}])}(),function(e){try{e=angular.module("pw.canvas-painter")}catch(t){e=angular.module("pw.canvas-painter",[])}e.run(["$templateCache",function(e){e.put("color-selector.html",'<ul class="pwColorSelector"><li ng-repeat="color in colorList track by $index" class="pwColor" ng-class="{\'active\': selectedIndex === $index}" style="background-color: {{color}}" ng-click="select($index, color)"></li></ul>')}])}(),angular.module("pw.canvas-painter",[]),angular.module("pw.canvas-painter").directive("pwCanvas",function(){return{restrict:"AE",scope:{options:"="},templateUrl:"../templates/canvas.html",link:function(t){var n="ontouchstart"in document.documentElement,o=t.options;o.width=o.width||400,o.height=o.height||300,o.backgroundColor=o.backgroundColor||"#fff",o.color=o.color||"#000",o.undoEnabled=o.undoEnabled||!1,o.opacity=o.opacity||.9,o.lineWidth=o.lineWidth||1;var a=document.getElementById("pwCanvasMain"),i=document.getElementById("pwCanvasTmp"),l=a.getContext("2d"),c=i.getContext("2d"),r={x:0,y:0},s=[],u=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;a.width=i.width=o.width,a.height=i.height=o.height,l.fillStyle=o.backgroundColor,l.fillRect(0,0,a.width,a.height),c.globalAlpha=o.opacity,c.lineJoin=c.lineCap="round",c.lineWidth=10,c.strokeStyle=o.color,t.$watch("options.lineWidth",function(e){e&&"number"==typeof e&&(c.lineWidth=o.lineWidth=e)}),t.$watch("options.color",function(e){e&&(c.strokeStyle=c.fillStyle=e)}),t.$watch("options.opacity",function(e){e&&(c.globalAlpha=e)});var d=function(){n?(i.addEventListener("touchstart",function(e){i.addEventListener("touchmove",p,!1),u?(r.x=e.layerX,r.y=e.layerY):(r.x=e.changedTouches[0].clientX+e.layerX,r.y=e.changedTouches[0].clientY+e.layerY),s.push({x:r.x,y:r.y}),s.push({x:r.x,y:r.y}),v()},!1),i.addEventListener("touchend",function(){i.removeEventListener("touchmove",p,!1),l.drawImage(i,0,0),c.clearRect(0,0,i.width,i.height),s=[]},!1)):(e.addEventListener("mouseup",function(){i.removeEventListener("mousemove",h,!1),l.drawImage(i,0,0),c.clearRect(0,0,i.width,i.height),s=[]},!1),i.addEventListener("mousedown",function(e){e.preventDefault(),i.addEventListener("mousemove",h,!1),r.x=void 0!==e.offsetX?e.offsetX:e.layerX,r.y=void 0!==e.offsetY?e.offsetY:e.layerY,s.push({x:r.x,y:r.y}),s.push({x:r.x,y:r.y}),v()},!1),i.addEventListener("mouseup",function(){i.removeEventListener("mousemove",h,!1),l.drawImage(i,0,0),c.clearRect(0,0,i.width,i.height),s=[]},!1))},h=function(e){r.x="undefined"!=typeof e.offsetX?e.offsetX:e.layerX,r.y="undefined"!=typeof e.offsetY?e.offsetY:e.layerY,v()},p=function(e){e.preventDefault(),u?(r.x=e.layerX,r.y=e.layerY):(r.x=e.changedTouches[0].clientX+e.layerX,r.y=e.changedTouches[0].clientY+e.layerY),v()},v=function(){if(s.push({x:r.x,y:r.y}),3==s.length){var e=s[0];return c.beginPath(),c.arc(e.x,e.y,c.lineWidth/2,0,2*Math.PI,!0),c.fill(),c.closePath(),void 0}c.clearRect(0,0,i.width,i.height),c.beginPath(),c.moveTo(s[0].x,s[0].y);for(var t=1;t<s.length-2;t++){var n=(s[t].x+s[t+1].x)/2,o=(s[t].y+s[t+1].y)/2;c.quadraticCurveTo(s[t].x,s[t].y,n,o)}c.quadraticCurveTo(s[t].x,s[t].y,s[t+1].x,s[t+1].y),c.stroke()};d()}}}),angular.module("pw.canvas-painter").directive("pwColorSelector",function(){return{restrict:"AE",replace:!0,scope:{colorList:"=pwColorSelector",color:"="},templateUrl:"../templates/color-selector.html",link:function(e){e.select=function(t,n){e.selectedIndex=t,e.color=n}}}})}(this);